#!/bin/bash
set -e

GREEN='\\033[0;32m'
YELLOW='\\033[1;33m'
RED='\\033[0;31m'
NC='\\033[0m'

echo "üîç Running pre-push checks..."

# Check for uncommitted changes
echo "${YELLOW}‚ñ∂ Checking for uncommitted changes...${NC}"
if [ -n "$(git status --porcelain)" ]; then
  echo ""
  echo "${RED}‚ùå You have uncommitted changes!${NC}"
  echo "${YELLOW}Please commit or stash your changes before pushing.${NC}"
  git status --short
  exit 1
fi
echo "${GREEN}‚úì No uncommitted changes${NC}"

# Check for untracked files (optional warning)
UNTRACKED=$(git ls-files --others --exclude-standard | wc -l | tr -d ' ')
if [ "$UNTRACKED" -gt 0 ]; then
  echo ""
  echo "${YELLOW}‚ö†Ô∏è  Warning: You have $UNTRACKED untracked file(s).${NC}"
  echo "${YELLOW}   Consider committing or adding them to .gitignore${NC}"
  echo ""
  git ls-files --others --exclude-standard
fi

# Run ESLint
echo "${YELLOW}‚ñ∂ Running ESLint...${NC}"
pnpm lint

if [ $? -ne 0 ]; then
  echo ""
  echo "${RED}‚ùå Pre-push check failed: Linting errors detected.${NC}"
  echo "${YELLOW}   Run 'pnpm lint:fix' to auto-fix issues.${NC}"
  exit 1
fi

# Run build check
echo "${YELLOW}üì¶ Running build check...${NC}"
pnpm build

if [ $? -ne 0 ]; then
  echo ""
  echo "${RED}‚ùå Pre-push check failed: Build errors detected.${NC}"
  exit 1
fi

echo "${GREEN}‚úÖ Pre-push checks passed!${NC}"
exit 0
